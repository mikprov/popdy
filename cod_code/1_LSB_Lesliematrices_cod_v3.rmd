---
title: "Create Leslie & LSB matrices from cod data"
author: "Mikaela Provost"
date: "December 6, 2017"
output: html_document
---


```{r}
# ---
# plan:
# 1. read cod data, break in separate populations
# 2. load functions


rm(list=ls())

# ---
# 1. load cod data, break into separate populations
# ---
source("C:/Users/provo/Documents/GitHub/popdy/cod_code/0_load_cod_data.r")
# this loads 'datalist' which has the data for each population
# combined into one list
        
# ---
# 2. load functions
# ---
source("C:/Users/provo/Documents/GitHub/popdy/cod_code/2_cod_functions.r")
  # assemble_Leslie()
  # extract_first_eigen_value()
  # calc_LSB_at_age_by_F()


# ---
# 3. execute functions for each population of cod, export Leslie 
# ---

# prep for looping
tknot = 0
k = 1
F.halfmax = 0

# loop over pop data in datalist to generate Leslie matrices
Alist = as.list(rep(NA,length(datalist))) # store Leslie matrix
names(Alist) = codNames



# step through each dataset in datalist
for (i in 1:length(names(Alist))) {
  # load parms for cod pop i
  source(file = paste('C:/Users/provo/Documents/GitHub/popdy/cod_pops/',names(Alist)[i], '.r', sep=''))
  # this should load parms: L_inf, K, TEMP, maxage
  Alist[[i]]=assemble_Leslie(data=datalist[[i]], littlek=k, maxage=maxage, K=K, L_inf=L_inf, TEMP=TEMP,
                             F.halfmax=0,tknot=0)
  newfecunds=Alist[[i]][1,] * multiplier_value #adjust fecundities so that lambda1 = 1
  Alist[[i]][1,] <- newfecunds #replace new fecundities with old in Leslie 
  write.table(Alist[[i]],
              file=paste("C:/Users/provo/Documents/GitHub/popdy/cod_code/mikaelaLeslie/k1_adjustlambda/",
                         codNames[i],".txt",sep=""))
}
rm(K,L_inf,maxage)


# ---
# 4. execute functions for each population of cod, export LSB matrices 
# ---

#prep for looping
tknot = 0
k = 1
F.halfmax = seq(0,3,by=0.2)

# loop over pop data in datalist to generate LSB matrices
LSBlist = as.list(rep(NA,length(datalist))) # store matrix of LSB vs F
names(LSBlist) = codNames

for (i in 1:length(datalist)) { # step through each pop in datalist
   # load parms for cod pop i
  source(file = paste('C:/Users/provo/Documents/GitHub/popdy/cod_pops/',names(LSBlist)[i], '.r', sep=''))
  # this should load parms: L_inf, K, TEMP, maxage
  
  LSBlist[[i]] = calculate_LSB_at_age_by_F(data=datalist[[i]], littlek=k, maxage=maxage, L_inf=L_inf, K=K, TEMP=TEMP, F.halfmax=F.halfmax)
  # store the output from calculate_LSB.. function in list. output is LSB by age and F
  write.table(LSBlist[[i]],
              file=paste("C:/Users/provo/Documents/GitHub/popdy/cod_code/mikaelaLSB/LSBmatrix_maxages/",
                         codNames[i],".txt",sep=""))
}


lsb <- read.table("C:/Users/provo/Documents/GitHub/popdy/cod_code/mikaelaLSB/LSBmatrix_maxages/GM.txt")
matplot(lsb,type="l")

```

